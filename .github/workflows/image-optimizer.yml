name: 'Optimize Bundle Images with ShortPixel'
on:
  push:
    branches:
      - main
    paths:
      - 'content/**/*.jpg'
      - 'content/**/*.png'
      - 'content/**/*.jpeg'
 
  schedule:
    - cron: '0 0 * * *'
    
  workflow_dispatch:
jobs:
  build:
    name: Convert Images Job
    runs-on: ubuntu-latest
    
    permissions:
      contents: write
      
    if: github.event.pusher.name != 'GitHub Actions Bot' && github.event.pusher.name != 'github-actions[bot]'
    steps:
      - name: 'â¬‡ï¸ Checkout Code'
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: 'ğŸ”„ Pull Latest Changes'
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          git pull origin main || true

      - name: 'ğŸ”§ Install Dependencies'
        run: sudo apt-get update && sudo apt-get install -y imagemagick jq bc

      - name: 'ğŸ”„ Find Images to Process'
        id: find_files
        run: |
          echo "ğŸ” Finding images that need conversion..."
          
          FILES_TO_PROCESS=""
          
          # ä½¿ç”¨ for å¾ªç¯ä»£æ›¿ find æ¥é¿å…è¯­æ³•é”™è¯¯
          for ext in jpg jpeg png; do
            for file in $(find content -type f -name "*.${ext}" 2>/dev/null || true); do
              if [ -f "$file" ]; then
                base_path="${file%.*}"
                
                # è·å–åŸå›¾å°ºå¯¸
                dimensions=$(identify -format "%wx%h" "$file" 2>/dev/null || echo "0x0")
                width=$(echo "$dimensions" | cut -d'x' -f1)
                height=$(echo "$dimensions" | cut -d'x' -f2)
                
                # å®šä¹‰éœ€è¦çš„å°ºå¯¸
                sizes="256 384 512 768 1024 1536 2048 3072 4096"
                
                # æ ‡è®°æ˜¯å¦éœ€è¦å¤„ç†è¿™ä¸ªæ–‡ä»¶
                needs_processing=false
                
                # æ£€æŸ¥åŸå›¾AVIF
                if [ "$width" -le 4096 ] && [ ! -f "${base_path}.avif" ]; then
                  needs_processing=true
                  echo "  Missing original AVIF for: $file"
                fi
                
                # æ£€æŸ¥åŸå›¾16:9ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ï¼‰
                if [ "$width" -le 4096 ] && [ ! -f "${base_path}-16x9.avif" ]; then
                  # åˆ¤æ–­åŸå›¾æ˜¯å¦ä¸º16:9æ¯”ä¾‹ï¼ˆå…è®¸1%çš„è¯¯å·®ï¼‰
                  aspect_ratio=$(echo "scale=3; $width / $height" | bc -l 2>/dev/null || echo "1.777")
                  target_ratio=$(echo "scale=3; 16 / 9" | bc -l)
                  ratio_diff=$(echo "scale=3; if ($aspect_ratio > $target_ratio) $aspect_ratio - $target_ratio else $target_ratio - $aspect_ratio" | bc -l 2>/dev/null || echo "0")
                  tolerance=$(echo "scale=3; $target_ratio * 0.01" | bc -l)
                  
                  # å¦‚æœä¸æ˜¯16:9æ¯”ä¾‹ï¼Œéœ€è¦ç”Ÿæˆ16:9ç‰ˆæœ¬
                  if (( $(echo "$ratio_diff > $tolerance" | bc -l 2>/dev/null || echo "1") )); then
                    needs_processing=true
                    echo "  Missing original 16:9 AVIF for: $file"
                  fi
                fi
                
                # æ£€æŸ¥å„ä¸ªå°ºå¯¸ç‰ˆæœ¬
                for size in $sizes; do
                  if [ "$width" -gt "$size" ]; then
                    # æ£€æŸ¥å¸¸è§„å°ºå¯¸ç‰ˆæœ¬
                    if [ ! -f "${base_path}_${size}w.avif" ]; then
                      needs_processing=true
                      echo "  Missing ${size}w AVIF for: $file"
                    fi
                    
                    # æ£€æŸ¥16:9å°ºå¯¸ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ï¼‰
                    if [ ! -f "${base_path}_${size}w-16x9.avif" ]; then
                      # åˆ¤æ–­åŸå›¾æ˜¯å¦ä¸º16:9æ¯”ä¾‹ï¼ˆå…è®¸1%çš„è¯¯å·®ï¼‰
                      aspect_ratio=$(echo "scale=3; $width / $height" | bc -l 2>/dev/null || echo "1.777")
                      target_ratio=$(echo "scale=3; 16 / 9" | bc -l)
                      ratio_diff=$(echo "scale=3; if ($aspect_ratio > $target_ratio) $aspect_ratio - $target_ratio else $target_ratio - $aspect_ratio" | bc -l 2>/dev/null || echo "0")
                      tolerance=$(echo "scale=3; $target_ratio * 0.01" | bc -l)
                      
                      # å¦‚æœä¸æ˜¯16:9æ¯”ä¾‹ï¼Œéœ€è¦ç”Ÿæˆ16:9ç‰ˆæœ¬
                      if (( $(echo "$ratio_diff > $tolerance" | bc -l 2>/dev/null || echo "1") )); then
                        needs_processing=true
                        echo "  Missing ${size}w-16x9 AVIF for: $file"
                      fi
                    fi
                  fi
                done
                
                # å¦‚æœéœ€è¦å¤„ç†ï¼Œæ·»åŠ åˆ°åˆ—è¡¨ä¸­
                if [ "$needs_processing" = "true" ]; then
                  FILES_TO_PROCESS="$FILES_TO_PROCESS $file"
                fi
              fi
            done
          done
          
          # è¾“å‡ºç»“æœ
          if [ -n "$FILES_TO_PROCESS" ]; then
            echo "files_to_process=$FILES_TO_PROCESS" >> $GITHUB_OUTPUT
            echo "  - Found $(echo $FILES_TO_PROCESS | wc -w) images needing processing."
          else
            echo "files_to_process=" >> $GITHUB_OUTPUT
            echo "âœ… No images to process."
          fi

      - name: 'ğŸš€ Process Images with ShortPixel'
        if: steps.find_files.outputs.files_to_process != ''
        env:
          SHORTPIXEL_KEY: ${{ secrets.SHORTPIXEL_KEY }}
          FILES_TO_PROCESS: ${{ steps.find_files.outputs.files_to_process }}
          MAX_ATTEMPTS: 5
          POLL_INTERVAL_SECONDS: 30
        run: |
          # ç”¨äºè·Ÿè¸ªå·²å¤„ç†çš„åŸå§‹æ–‡ä»¶
          declare -A processed_originals
          declare -A file_dimensions
          
          # é¦–å…ˆè·å–æ‰€æœ‰æ–‡ä»¶çš„å°ºå¯¸ä¿¡æ¯
          for file_path in $FILES_TO_PROCESS; do
            if [ -f "$file_path" ]; then
              dimensions=$(identify -format "%wx%h" "$file_path")
              file_dimensions["$file_path"]="$dimensions"
              echo "ğŸ“ Processing $file_path ($dimensions)"
            fi
          done
          
          # å¤„ç†æ¯ä¸ªæ–‡ä»¶
          for file_path in $FILES_TO_PROCESS; do
            if [ ! -f "$file_path" ]; then
              echo "âš ï¸ File not found: $file_path"
              continue
            fi
            
            echo -e "\nğŸ”„ Processing: $file_path"
            base_url="https://raw.githubusercontent.com/${{ github.repository }}/${{ github.sha }}/$file_path"
            base_path="${file_path%.*}"
            dir_path=$(dirname "$file_path")
            base_name=$(basename "$file_path" | sed 's/\.[^.]*$//')
            
            # ä»ç¼“å­˜çš„å°ºå¯¸ä¿¡æ¯è·å–
            dimensions="${file_dimensions[$file_path]}"
            width=$(echo "$dimensions" | cut -d'x' -f1)
            height=$(echo "$dimensions" | cut -d'x' -f2)
            
            echo "  Original dimensions: ${width}x${height}"
            
            # å®šä¹‰éœ€è¦ç”Ÿæˆçš„å°ºå¯¸
            sizes="256 384 512 768 1024 1536 2048 3072 4096"
            
            # æ£€æŸ¥åŸå›¾å¤„ç†ï¼ˆåªæœ‰å®½åº¦<=4096ä¸”ä¸å­˜åœ¨å¯¹åº”AVIFçš„æ‰å¤„ç†ï¼‰
            if [ "$width" -le 4096 ] && [ ! -f "${base_path}.avif" ]; then
              echo "  - Will generate original size AVIF (${width}x${height})"
              
              # å¤„ç†åŸå›¾
              echo "    Processing original..."
              success=false
              for attempt in $(seq 1 $MAX_ATTEMPTS); do
                echo "      Attempt $attempt/$MAX_ATTEMPTS"
                
                JSON_PAYLOAD='{
                  "key": "'$SHORTPIXEL_KEY'",
                  "plugin_version": "GHA45",
                  "lossy": 2,
                  "wait": 30,
                  "urllist": ["'$base_url'"],
                  "paramlist": [{
                    "resize": 0,
                    "convertto": "avif"
                  }]
                }'
                
                API_RESPONSE=$(curl -s -X POST -H "Content-Type: application/json" -d "$JSON_PAYLOAD" https://api.shortpixel.com/v2/reducer.php)
                
                if [ -n "$API_RESPONSE" ] && echo "$API_RESPONSE" | jq empty 2>/dev/null; then
                  status_code=$(echo "$API_RESPONSE" | jq -r '.[0].Status.Code // empty')
                  avif_url=$(echo "$API_RESPONSE" | jq -r '.[0].AVIFLossyURL // empty')
                  
                  if [ "$status_code" = "2" ] && [ -n "$avif_url" ] && [ "$avif_url" != "null" ] && [ "$avif_url" != "NA" ]; then
                    if curl -fsS --retry 2 -o "${base_path}.avif" "$avif_url"; then
                      echo "      âœ… Successfully generated: $(basename "${base_path}.avif")"
                      processed_originals["$file_path"]=1
                      success=true
                      break
                    else
                      echo "      âŒ Failed to download from: $avif_url"
                    fi
                  else
                    echo "      âŒ API failed with status: $status_code"
                    if [ -n "$API_RESPONSE" ]; then
                      echo "      Error: $(echo "$API_RESPONSE" | jq -r '.[0].Status.Message // "Unknown error"')"
                    fi
                  fi
                else
                  echo "      âŒ Invalid API response"
                fi
                
                if [ "$attempt" -lt "$MAX_ATTEMPTS" ]; then
                  echo "      Waiting ${POLL_INTERVAL_SECONDS}s before retry..."
                  sleep $POLL_INTERVAL_SECONDS
                fi
              done
              
              if [ "$success" != "true" ]; then
                echo "      âš ï¸ Failed to generate original after $MAX_ATTEMPTS attempts"
              fi
            elif [ "$width" -gt 4096 ]; then
              echo "  - Skipping original size AVIF (${width}x${height} > 4096w limit)"
            fi

            # å¤„ç†åŸå›¾çš„16:9ç‰ˆæœ¬ï¼ˆå¦‚æœéœ€è¦ä¸”ä¸å­˜åœ¨ï¼‰
            if [ "$width" -le 4096 ] && [ ! -f "${base_path}-16x9.avif" ]; then
              # åˆ¤æ–­åŸå›¾æ˜¯å¦ä¸º16:9æ¯”ä¾‹ï¼ˆå…è®¸1%çš„è¯¯å·®ï¼‰
              aspect_ratio=$(echo "scale=3; $width / $height" | bc -l)
              target_ratio=$(echo "scale=3; 16 / 9" | bc -l)
              ratio_diff=$(echo "scale=3; if ($aspect_ratio > $target_ratio) $aspect_ratio - $target_ratio else $target_ratio - $aspect_ratio" | bc -l)
              tolerance=$(echo "scale=3; $target_ratio * 0.01" | bc -l) # 1%è¯¯å·®
              
              # å¦‚æœä¸æ˜¯16:9æ¯”ä¾‹ï¼Œç”Ÿæˆ16:9ç‰ˆæœ¬
              if (( $(echo "$ratio_diff > $tolerance" | bc -l) )); then
                target_height16x9=$((width * 9 / 16))
                echo "  - Will generate original 16:9 version (${width}x${target_height16x9})"
                
                echo "    Processing original 16:9..."
                success=false
                for attempt in $(seq 1 $MAX_ATTEMPTS); do
                  echo "      Attempt $attempt/$MAX_ATTEMPTS"
                  
                  JSON_PAYLOAD='{
                    "key": "'$SHORTPIXEL_KEY'",
                    "plugin_version": "GHA45",
                    "lossy": 2,
                    "wait": 30,
                    "urllist": ["'$base_url'"],
                    "paramlist": [{
                      "resize": 4,
                      "resize_width": '$width',
                      "resize_height": '$target_height16x9',
                      "convertto": "avif"
                    }]
                  }'
                  
                  API_RESPONSE=$(curl -s -X POST -H "Content-Type: application/json" -d "$JSON_PAYLOAD" https://api.shortpixel.com/v2/reducer.php)
                  
                  if [ -n "$API_RESPONSE" ] && echo "$API_RESPONSE" | jq empty 2>/dev/null; then
                    status_code=$(echo "$API_RESPONSE" | jq -r '.[0].Status.Code // empty')
                    avif_url=$(echo "$API_RESPONSE" | jq -r '.[0].AVIFLossyURL // empty')
                    
                    if [ "$status_code" = "2" ] && [ -n "$avif_url" ] && [ "$avif_url" != "null" ] && [ "$avif_url" != "NA" ]; then
                      if curl -fsS --retry 2 -o "${base_path}-16x9.avif" "$avif_url"; then
                        echo "      âœ… Successfully generated: $(basename "${base_path}-16x9.avif")"
                        success=true
                        break
                      else
                        echo "      âŒ Failed to download from: $avif_url"
                      fi
                    else
                      echo "      âŒ API failed with status: $status_code"
                      if [ -n "$API_RESPONSE" ]; then
                        echo "      Error: $(echo "$API_RESPONSE" | jq -r '.[0].Status.Message // "Unknown error"')"
                      fi
                    fi
                  else
                    echo "      âŒ Invalid API response"
                  fi
                  
                  if [ "$attempt" -lt "$MAX_ATTEMPTS" ]; then
                    echo "      Waiting ${POLL_INTERVAL_SECONDS}s before retry..."
                    sleep $POLL_INTERVAL_SECONDS
                  fi
                done
                
                if [ "$success" != "true" ]; then
                  echo "      âš ï¸ Failed to generate original 16:9 after $MAX_ATTEMPTS attempts"
                fi
              elif (( $(echo "$ratio_diff <= $tolerance" | bc -l) )); then
                echo "  - Skipping original 16:9 version (already 16:9 ratio)"
              fi
            fi
            
            # å¤„ç†å„ä¸ªå°ºå¯¸
            for target_width in $sizes; do
              if [ "$width" -gt "$target_width" ]; then
                
                # å¤„ç†å¸¸è§„å°ºå¯¸ç‰ˆæœ¬
                if [ ! -f "${base_path}_${target_width}w.avif" ]; then
                  echo "  - Processing ${target_width}w version..."
                  
                  # APIè°ƒç”¨é€»è¾‘ï¼ˆä¿æŒä¸å˜ï¼‰
                  success=false
                  for attempt in $(seq 1 $MAX_ATTEMPTS); do
                    echo "      Attempt $attempt/$MAX_ATTEMPTS"
                    
                    JSON_PAYLOAD='{
                      "key": "'$SHORTPIXEL_KEY'",
                      "plugin_version": "GHA45",
                      "lossy": 2,
                      "wait": 30,
                      "urllist": ["'$base_url'"],
                      "paramlist": [{
                        "resize": 3,
                        "resize_width": '$target_width',
                        "resize_height": 99999,
                        "convertto": "avif"
                      }]
                    }'
                    
                    API_RESPONSE=$(curl -s -X POST -H "Content-Type: application/json" -d "$JSON_PAYLOAD" https://api.shortpixel.com/v2/reducer.php)
                    
                    if [ -n "$API_RESPONSE" ] && echo "$API_RESPONSE" | jq empty 2>/dev/null; then
                      status_code=$(echo "$API_RESPONSE" | jq -r '.[0].Status.Code // empty')
                      avif_url=$(echo "$API_RESPONSE" | jq -r '.[0].AVIFLossyURL // empty')
                      
                      if [ "$status_code" = "2" ] && [ -n "$avif_url" ] && [ "$avif_url" != "null" ] && [ "$avif_url" != "NA" ]; then
                        output_file="${base_path}_${target_width}w.avif"
                        if curl -fsS --retry 2 -o "$output_file" "$avif_url"; then
                          echo "      âœ… Successfully generated: $(basename "$output_file")"
                          success=true
                          break
                        else
                          echo "      âŒ Failed to download from: $avif_url"
                        fi
                      else
                        echo "      âŒ API failed with status: $status_code"
                        if [ -n "$API_RESPONSE" ]; then
                          echo "      Error: $(echo "$API_RESPONSE" | jq -r '.[0].Status.Message // "Unknown error"')"
                        fi
                      fi
                    else
                      echo "      âŒ Invalid API response"
                    fi
                    
                    if [ "$attempt" -lt "$MAX_ATTEMPTS" ]; then
                      echo "      Waiting ${POLL_INTERVAL_SECONDS}s before retry..."
                      sleep $POLL_INTERVAL_SECONDS
                    fi
                  done
                  
                  if [ "$success" != "true" ]; then
                    echo "      âš ï¸ Failed to generate ${target_width}w after $MAX_ATTEMPTS attempts"
                  fi
                else
                  echo "  - ${target_width}w version already exists, skipping"
                fi

                # å¤„ç†16:9ç‰ˆæœ¬ï¼ˆç‹¬ç«‹æ£€æŸ¥ï¼Œä¸ä¾èµ–ä¸Šé¢çš„successçŠ¶æ€ï¼‰
                if [ ! -f "${base_path}_${target_width}w-16x9.avif" ]; then
                  # åˆ¤æ–­åŸå›¾æ˜¯å¦ä¸º16:9æ¯”ä¾‹
                  aspect_ratio=$(echo "scale=3; $width / $height" | bc -l)
                  target_ratio=$(echo "scale=3; 16 / 9" | bc -l)
                  ratio_diff=$(echo "scale=3; if ($aspect_ratio > $target_ratio) $aspect_ratio - $target_ratio else $target_ratio - $aspect_ratio" | bc -l)
                  tolerance=$(echo "scale=3; $target_ratio * 0.01" | bc -l)
                  
                  # å¦‚æœä¸æ˜¯16:9æ¯”ä¾‹ï¼Œç”Ÿæˆ16:9ç‰ˆæœ¬
                  if (( $(echo "$ratio_diff > $tolerance" | bc -l) )); then
                    target_height16x9=$((target_width * 9 / 16))
                    echo "  - Processing ${target_width}w 16:9 version (${target_width}x${target_height16x9})..."
                    
                    success16x9=false
                    for attempt in $(seq 1 $MAX_ATTEMPTS); do
                      echo "      Attempt $attempt/$MAX_ATTEMPTS for ${target_width}w 16:9"
                      
                      JSON_PAYLOAD='{
                        "key": "'$SHORTPIXEL_KEY'",
                        "plugin_version": "GHA45",
                        "lossy": 2,
                        "wait": 30,
                        "urllist": ["'$base_url'"],
                        "paramlist": [{
                          "resize": 4,
                          "resize_width": '$target_width',
                          "resize_height": '$target_height16x9',
                          "convertto": "avif"
                        }]
                      }'
                      
                      API_RESPONSE=$(curl -s -X POST -H "Content-Type: application/json" -d "$JSON_PAYLOAD" https://api.shortpixel.com/v2/reducer.php)
                      
                      if [ -n "$API_RESPONSE" ] && echo "$API_RESPONSE" | jq empty 2>/dev/null; then
                        status_code=$(echo "$API_RESPONSE" | jq -r '.[0].Status.Code // empty')
                        avif_url=$(echo "$API_RESPONSE" | jq -r '.[0].AVIFLossyURL // empty')
                        
                        if [ "$status_code" = "2" ] && [ -n "$avif_url" ] && [ "$avif_url" != "null" ] && [ "$avif_url" != "NA" ]; then
                          output_file="${base_path}_${target_width}w-16x9.avif"
                          if curl -fsS --retry 2 -o "$output_file" "$avif_url"; then
                            echo "      âœ… Successfully generated: $(basename "$output_file")"
                            success16x9=true
                            break
                          else
                            echo "      âŒ Failed to download from: $avif_url"
                          fi
                        else
                          echo "      âŒ API failed with status: $status_code"
                          if [ -n "$API_RESPONSE" ]; then
                            echo "      Error: $(echo "$API_RESPONSE" | jq -r '.[0].Status.Message // "Unknown error"')"
                          fi
                        fi
                      else
                        echo "      âŒ Invalid API response"
                      fi
                      
                      if [ "$attempt" -lt "$MAX_ATTEMPTS" ]; then
                        echo "      Waiting ${POLL_INTERVAL_SECONDS}s before retry..."
                        sleep $POLL_INTERVAL_SECONDS
                      fi
                    done
                    
                    if [ "$success16x9" != "true" ]; then
                      echo "      âš ï¸ Failed to generate ${target_width}w 16:9 after $MAX_ATTEMPTS attempts"
                    fi
                  else
                    echo "  - Skipping ${target_width}w 16:9 version (already 16:9 ratio)"
                  fi
                else
                  echo "  - ${target_width}w 16:9 version already exists, skipping"
                fi
              fi
            done

          done
          
          # ç»Ÿä¸€å¤„ç†æ‰€æœ‰æˆåŠŸè½¬æ¢çš„åŸå§‹æ–‡ä»¶
          echo -e "\nğŸ—‚ï¸ Updating .image_dimensions.yaml for all original files..."
          for original_file in $FILES_TO_PROCESS; do
            if [ -f "$original_file" ]; then
              base_path="${original_file%.*}"
              dir_path=$(dirname "$original_file")
              base_name=$(basename "$original_file" | sed 's/\.[^.]*$//')
              yaml_file="$dir_path/.image_dimensions.yaml"
              touch "$yaml_file"

              # è·å–å°ºå¯¸
              dimensions=$(identify -format "%wx%h" "$original_file")

              # å†™å…¥ YAMLï¼ˆå¦‚æœå·²å­˜åœ¨åˆ™æ›´æ–°ï¼Œå¦åˆ™æ–°å¢ï¼‰
              if grep -q "^${base_name}:" "$yaml_file" 2>/dev/null; then
                sed -i "s|^${base_name}:.*|${base_name}: ${dimensions}|" "$yaml_file"
              else
                echo "${base_name}: ${dimensions}" >> "$yaml_file"
              fi

              # å¯é€‰ï¼šlog æ˜¯å¦ç”Ÿæˆäº† AVIF æ–‡ä»¶
              if [ -f "${base_path}.avif" ] || ls "${base_path}_"*"w.avif" >/dev/null 2>&1; then
                echo "  âœ… AVIF exists for: $base_name"
              else
                echo "  âš ï¸ No AVIF files for: $base_name"
              fi
            fi
          done
      
      - name: 'ğŸš€ Commit and Push Changes'
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          # ğŸ›¡ï¸ å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿æˆ‘ä»¬æœ‰æœ€æ–°çš„è¿œç¨‹çŠ¶æ€
          git fetch origin main

          # ğŸ›¡ï¸ æ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æäº¤
          LOCAL_BASE=$(git rev-parse HEAD)
          REMOTE_HEAD=$(git rev-parse origin/main)

          if [ "$LOCAL_BASE" != "$REMOTE_HEAD" ]; then
            echo "âš ï¸ æ£€æµ‹åˆ°è¿œç¨‹ä»“åº“æœ‰æ–°æäº¤ï¼Œä¸ºé¿å…è¦†ç›–ï¼Œç»ˆæ­¢æ“ä½œ"
            echo "è¯·é‡æ–°è¿è¡Œå·¥ä½œæµæ¥å¤„ç†æœ€æ–°çš„æ›´æ”¹"
            echo "Local: $LOCAL_BASE"
            echo "Remote: $REMOTE_HEAD"
            exit 1
          fi
          
          echo "ğŸ” Checking for changes..."
          git add content/
          if git diff --cached --quiet; then
            echo "ğŸ“­ No changes to commit"
          else
            echo "âœ… Found changes, committing..."
            git commit -m "build(media): Convert images to multi-size AVIF"

            # ğŸ›¡ï¸ æœ€åä¸€æ¬¡æ£€æŸ¥ï¼Œç„¶åå®‰å…¨æ¨é€
            git fetch origin main
            git push origin main
            echo "ğŸš€ Changes pushed successfully"
          fi
