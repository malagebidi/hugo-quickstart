{{/*
  File: layouts/shortcodes/image.html
  Simple Debug Version
*/}}
{{ $src := .Get "src" }}
{{ $alt := .Get "alt" | default $src }}
{{ $class := .Get "class" }}
{{ $avifPath := printf "%s.avif" $src }}
{{ $avifResource := .Page.Resources.GetMatch $avifPath }}

<div style="border: 1px solid #ccc; padding: 10px; margin: 10px 0; font-family: monospace; font-size: 12px;">
  <strong>Debug Info:</strong><br>
  Looking for: {{ $avifPath }}<br>
  {{ if $avifResource }}
    ✅ AVIF Found: {{ $avifResource.RelPermalink }}<br>
    Resource Type: {{ printf "%T" $avifResource }}<br>
    {{ with $avifResource.ResourceType }}Category: {{ . }}<br>{{ end }}
    {{ with $avifResource.MediaType }}Media Type: {{ . }}<br>{{ end }}
  {{ else }}
    ❌ AVIF Not Found<br>
  {{ end }}
</div>

{{/* Safe rendering without Width/Height */}}
{{ if $avifResource }}
  <img 
    src="{{ $avifResource.RelPermalink }}" 
    alt="{{ $alt }}" 
    class="{{ $class }}" 
    loading="lazy">
{{ else }}
  {{ $originalResource := .Page.Resources.GetMatch (printf "%s.*" $src) }}
  {{ with $originalResource }}
    <img 
      src="{{ .RelPermalink }}" 
      alt="{{ $alt }}" 
      class="{{ $class }}" 
      loading="lazy">
  {{ else }}
    <p style="color: red;">No image found for: {{ $src }}</p>
  {{ end }}
{{ end }}
